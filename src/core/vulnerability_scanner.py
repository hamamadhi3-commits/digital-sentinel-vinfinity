"""
Digital Sentinel - Vulnerability Scanner
========================================
Scans crawled data for potential vulnerabilities (simulated phase).
"""

import os
import time

def run_vulnerability_scan():
    """Main vulnerability scanning phase."""
    print("ğŸš€ [Phase 4: Vulnerability Scanner Started]")

    input_dir = os.path.join("data", "cache", "crawled")
    output_dir = os.path.join("data", "cache", "vulnerabilities")
    os.makedirs(output_dir, exist_ok=True)

    input_file = os.path.join(input_dir, "crawl_results.txt")
    output_file = os.path.join(output_dir, "scan_report.txt")

    if not os.path.exists(input_file):
        print(f"âš ï¸ Crawling results not found at {input_file}")
        return

    print("ğŸ” Analyzing crawled pages for vulnerabilities...")
    time.sleep(2)  # simulate scanning delay

    # Simulated vulnerability detection
    with open(input_file, "r") as f:
        urls = [line.strip() for line in f.readlines()]

    findings = []
    for url in urls:
        if "page1" in url:
            findings.append(f"[HIGH] SQLi vulnerability suspected at {url}")
        elif "page2" in url:
            findings.append(f"[MEDIUM] XSS pattern detected at {url}")
        else:
            findings.append(f"[INFO] No issues found at {url}")

    # Save scan report
    with open(output_file, "w") as out:
        out.write("\n".join(findings))

    print(f"ğŸ’¾ Vulnerability scan report saved to {output_file}")
    print("ğŸ”š [Phase 4: Vulnerability Scanner Completed]")


if __name__ == "__main__":
    run_vulnerability_scan()
